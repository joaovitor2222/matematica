<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Math Horror Game ‚Äî Personalizado</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    h1, h2 { margin-bottom: 0.5em; }
    label { display: block; margin: 10px 0 5px; }
    input[type="text"], input[type="number"], select {
      width: 80%;
      padding: 8px;
      font-size: 1em;
      border-radius: 4px;
      border: 1px solid #444;
      background: #222;
      color: #eee;
      margin-bottom: 5px;
    }
    #questions-list {
      margin: 20px 0;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #444;
      padding: 10px;
    }
    #questions-list div {
      margin-bottom: 8px;
      padding: 6px;
      background: #222;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #questions-list div button {
      background: #ff3b3b;
      border: none;
      color: #fff;
      cursor: pointer;
      border-radius: 4px;
      padding: 4px 8px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      transition: background 0.2s;
    }
    button:hover { background: #0056b3; }

    /* ESTILOS DO JOGO EMBUTIDO */
    #game-personalizado { margin-top: 40px; }
    #game-personalizado.hidden { display: none; }
    #question { margin: 20px 0; font-size: 1.4em; }
    .choices button { margin: 5px; padding: 8px 16px; font-size: 1em; }
    #timer-display { font-size: 1.1em; color: #f55; margin-bottom: 10px; }
    #restart-button { display: none; margin-top: 20px; background: #ff3b3b; }
    #restart-button:hover { background: #e60000; }

    #home-button {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background-color: #007bff;
  padding: 10px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1000;
  opacity: 0.8;
  transition: opacity 0.3s, transform 0.3s;
}

#home-button img {
  width: 40px;
  height: 40px;
}

#home-button:hover {
  opacity: 1;
  transform: scale(1.1);
}

#home-button.hidden {
  display: none;
}




  </style>
</head>
<body>

  <h1>Modo Personalizado</h1>

  <!-- PAINEL DE CONFIGURA√á√ÉO -->
  <label for="difficulty">Dificuldade:</label>
  <select id="difficulty">
    <option value="easy">F√°cil</option>
    <option value="medium">M√©dio</option>
    <option value="hard">Dif√≠cil</option>
    <option value="impossible">Imposs√≠vel</option>
  </select>

  <label for="max-q">M√°ximo de perguntas:</label>
  <input type="number" id="max-q" value="10" min="1" max="50" />

  <h2>Adicionar pergunta</h2>
  <label for="new-expr">Express√£o (ex: 3+5*2):</label>
  <input type="text" id="new-expr" placeholder="Digite a express√£o" />

  <label for="new-answer">Resposta correta:</label>
  <input type="number" id="new-answer" placeholder="N√∫mero" />

  <button id="add-question">‚ûï Adicionar</button>

  <h2>Perguntas atuais</h2>
  <div id="questions-list"></div>

  <button id="start-custom">‚ñ∂Ô∏è Iniciar jogo personalizado</button>

  <!-- JOGO RODANDO ABAIXO -->
  <div id="game-personalizado" class="hidden">
    <div id="timer-display">Tempo restante: <span id="time">00:00</span></div>
    <div id="question"></div>
    <div class="choices"></div>
    <button id="restart-button" style="display:none; margin-top:20px;" onclick="location.reload()">
      Jogar Novamente
    </button>
  </div>

  <!-- Bot√£o de voltar ao √≠ndice -->
<a id="home-button" href="index.html" title="Voltar ao menu">
    <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Home">
  </a>
  

<script>
(() => {

  // Estado do painel
  const questions = [];
  const listEl = document.getElementById('questions-list');
  const exprInput = document.getElementById('new-expr');
  const ansInput  = document.getElementById('new-answer');
  const diffSel   = document.getElementById('difficulty');
  const maxQInput = document.getElementById('max-q');

  // Renderizar lista de perguntas
  function renderList() {
    listEl.innerHTML = '';
    questions.forEach((q,i) => {
      const div = document.createElement('div');
      div.textContent = `${i+1}. ${q.expr} = ${q.answer}`;
      const rm = document.createElement('button');
      rm.textContent = '‚ùå';
      rm.onclick = () => {
        questions.splice(i,1);
        renderList();
      };
      div.appendChild(rm);
      listEl.appendChild(div);
    });
  }

  // Adicionar pergunta
  document.getElementById('add-question').onclick = () => {
    const expr = exprInput.value.trim();
    const ans  = ansInput.value.trim();
    if (!expr || ans === '') {
      alert('Preencha express√£o e resposta!');
      return;
    }
    questions.push({ expr, answer: Number(ans) });
    exprInput.value = '';
    ansInput.value = '';
    renderList();
  };

  // Vari√°veis do jogo
  let cfg, questionCount, timerInterval, timerTimeout;

  // Iniciar jogo custom
  document.getElementById('start-custom').onclick = () => {
    if (questions.length === 0) {
      alert('Adicione ao menos uma pergunta!');
      return;
    }
    const mq = parseInt(maxQInput.value);
    if (isNaN(mq) || mq < 1) {
      alert('N√∫mero de perguntas inv√°lido!');
      return;
    }

    // 1Ô∏è‚É£ Primeiro cria o cfg:
    cfg = {
      questions: [...questions],
      maxQuestions: mq,
      difficulty: diffSel.value
    };

    // 2Ô∏è‚É£ Agora sim voc√™ pode calcular "needed":
    const needed = cfg.maxQuestions - cfg.questions.length;
    if (needed > 0) {
      for (let i = 0; i < needed; i++) {
        cfg.questions.push(generateAutoQuestion(cfg.difficulty));
      }
    }

    // 3Ô∏è‚É£ Depois come√ßa o jogo:
    document.getElementById('game-personalizado').classList.remove('hidden');
    document.getElementById('start-custom').disabled = true;

    questionCount = 0;
    startQuestion();
};

function restartGame() {
  // Sistema de dica b√¥nus
  const adubo = parseInt(localStorage.getItem('adubo') || '0');
  if (adubo >= 5) {
    freeHints++;
    alert('üéÅ Voc√™ ganhou 1 dica gr√°tis por jogar o jogo da fazenda!');
  }

  location.reload(); // Recarrega a p√°gina
}


  // Formatar MM:SS
  function formatTime(sec) {
    const m = String(Math.floor(sec/60)).padStart(2,'0');
    const s = String(sec%60).padStart(2,'0');
    return `${m}:${s}`;
  }

  // Iniciar temporizador
  function startTimer() {
    clearInterval(timerInterval);
    clearTimeout(timerTimeout);
    let maxTime = cfg.difficulty === 'easy'   ? 180
                : cfg.difficulty === 'medium' ? 100
                : cfg.difficulty === 'hard'   ? 50
                : /* impossible */            30;
    document.getElementById('time').textContent = formatTime(maxTime);
    let rem = maxTime;
    timerInterval = setInterval(() => {
      rem--;
      document.getElementById('time').textContent = formatTime(rem);
      if (rem <= 0) clearInterval(timerInterval);
    }, 1000);
    timerTimeout = setTimeout(() => handleAnswer(null, '__TIME_UP__'), maxTime*1000);
  }

  // Iniciar pr√≥xima pergunta
  function startQuestion() {
    questionCount++;
    const qObj = cfg.questions[(questionCount-1) % cfg.questions.length];
    document.getElementById('question').textContent =
      `Pergunta ${questionCount}: ${qObj.expr} = ?`;

    const choicesEl = document.querySelector('.choices');
    choicesEl.innerHTML = '';
    const correct = qObj.answer;
    const variants = new Set([correct]);
    while (variants.size < 4) {
      variants.add(correct + (Math.random()<0.5 ? -1 : 1)*(Math.floor(Math.random()*3)+1));
    }
    Array.from(variants).sort(() => Math.random()-0.5)
      .forEach(v => {
        const btn = document.createElement('button');
        btn.textContent = v;
        btn.onclick = () => handleAnswer(v, correct);
        choicesEl.appendChild(btn);
      });

    startTimer();
  }

  function generateAutoQuestion(diff) {
  // 1) Determina quantos operadores vamos ter:
  let minOps = diff === 'impossible' ? 3
             : diff === 'hard'       ? 2
             : diff === 'medium'     ? 1
             : /* easy */             0;  // Modo f√°cil come√ßa com 0 operadores

  let maxOps = diff === 'impossible' ? 4
             : diff === 'hard'       ? 3
             : diff === 'medium'     ? 2
             : /* easy */             1;  // Modo f√°cil permite no m√°ximo 1 operador

  // Ajuste para o modo f√°cil (80% chance de 1 operador e 20% de 0 operadores)
  const nOps = diff === 'easy'
    ? (Math.random() < 0.8 ? 1 : 0)  // 80% chance de 1 operador, 20% de 0 operadores
    : minOps + Math.floor(Math.random() * (maxOps - minOps + 1));

  // 2) Define o pool de operadores
  const opsPool = diff === 'impossible'
    ? ['+', '-', '*', '/', '‚àö']
    : ['+', '-', '*', '/'];

  // 3) Monta a express√£o explicitamente
  //    Vai ser algo como: [Term, Op, Term, Op, Term, ...]
  const parts = [];
  for (let i = 0; i < nOps + 1; i++) {
    // TERM: pode ser n√∫mero ou raiz (s√≥ em impossible)
    if (diff === 'impossible' && Math.random() < 0.3) {
      // insere raiz
      parts.push('‚àö');
      parts.push(randomInt(1, 20));
    } else {
      // s√≥ n√∫mero
      parts.push(randomInt(1, 20));
    }
    // se n√£o for o √∫ltimo termo, adiciona um operador
    if (i < nOps) {
      // escolhe um operador, mas raiz n√£o faz sentido aqui
      let op;
      if (diff === 'impossible') {
        // pool sem raiz para operadores
        const pool = ['+', '-', '*', '/'];
        op = pool[Math.floor(Math.random() * pool.length)];
      } else {
        op = opsPool[Math.floor(Math.random() * opsPool.length)];
      }
      parts.push(op);
    }
  }

  // 4) Transforma em duas strings: uma para mostrar (exprPlayer) e outra para avaliar (exprMachine)
  let exprPlayer = '';
  let exprMachine = '';
  for (let i = 0; i < parts.length; i++) {
    if (parts[i] === '‚àö') {
      exprPlayer  += `‚àö${parts[i+1]}`;
      exprMachine += `Math.sqrt(${parts[i+1]})`;
      i++; // pula o n√∫mero j√° tratado
    } else {
      exprPlayer  += parts[i];
      exprMachine += parts[i];
    }
  }

  console.log('Impossible expr:', exprMachine);

  // 5) Avalia com seguran√ßa
  let correct;
  try {
    correct = Math.round(eval(exprMachine));
    if (isNaN(correct)) throw new Error('NaN');
  } catch {
    // fallback: se der pau, geramos uma opera√ß√£o simples
    correct = randomInt(1, 10);
    exprPlayer  = String(correct);
    exprMachine = String(correct);
  }

  return { expr: exprPlayer, answer: correct };
}





function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}



  // Tratar resposta
  function handleAnswer(given, correct) {
    clearInterval(timerInterval);
    clearTimeout(timerTimeout);
    if (given == correct) {
      if (questionCount < cfg.maxQuestions) {
        alert('‚úîÔ∏è Certo!');
        startQuestion();
      } else {
        alert('üéâ Voc√™ terminou o modo personalizado!');
        document.getElementById('restart-button').style.display = 'inline-block';
      }
    } else {
      alert('‚ùå Errado...');
      document.getElementById('restart-button').style.display = 'inline-block';
    }
  }

})();
</script>
</body>
</html>
